--- 
wordpress_id: "56"
layout: post
title: CVS, ViewVC integration with Google Prettify
wordpress_url: http://sricharan.org/blog/?p=56
---
Been wanting to do this for long: browse SVN/CVS via a web interface. Ofcourse, it is a solved problem. But I wanted this set up for my own local CVS repos.<br /><br />ViewVC to the rescue.<br /><br />Prerequisites: Python2.x, Apache2.0+, CVS, CVS/SVN Python Bindings.<br /><br />Detailed installation process:<br />1. ViewVC:<br />I have CVSNT on my workstation. So I downloaded ViewVC-1.0.7  from <a href="http://www.viewvc.org/download.html">http://www.viewvc.org/download.html</a> (spcecifically, version 1.0.7 from<a href="http://viewvc.tigris.org/servlets/ProjectDocumentList?folderID=6004"> http://viewvc.tigris.org/servlets/ProjectDocumentList?folderID=6004</a>).<br /><br />To install ViewVC, first unpack it to some folder, run 'python viewvc-install' from the command line, with the current directory as the unpacked directory. I chose all the defaults values when prompted.<br /><br />Next, I configured viewvc to pick up my repositories by editing the <install-dir>/viewvc.conf file. I changed the cvs_roots and cvsnt_exe_path variables.<br /><br />2. SVN Python bindings for ViewVC:<br />ViewVC is written in python and <a href="http://www.blogger.com/tigris.org">tigris.org</a> provides python bindings to talk to the CVS/SVN repository. This can be got from <a href="http://subversion.tigris.org/getting.html#windows%20http://subversion.tigris.org/servlets/ProjectDocumentList?folderID=8100">subversion.tigris.org Documents Area.</a> Be sure to download the version appropirate for your version of python. Simply run the installer. You will be asked to point the installer to the Apache installation directory.<br /><br />3. mod_python:<br />You will need to download the mod_python for Apache if you dont have it already. You can check the <apache-install-dir>/modules/ directory. Look for mod_python.so file. If it is not here, download it from here: <a href="http://www.apache.org/dist/httpd/modpython/win/3.3.1/">http://www.apache.org/dist/httpd/modpython/win/3.3.1/</a> I used this: <a href="http://www.apache.org/dist/httpd/modpython/win/3.3.1/mod_python-3.3.1.win32-py2.5-Apache2.2.exe">http://www.apache.org/dist/httpd/modpython/win/3.3.1/mod_python-3.3.1.win32-py2.5-Apache2.2.exe</a><br /><br />4. Configuring Apache.<br />Edit the httpd.conf file to add the following:<br />a) 

 <code>LoadModule python_module modules/mod_python.so</code>

<br />b) 

 <code>ScriptAlias /viewcvs "C:/Program Files/viewvc-1.0.7/bin/mod_python/viewvc.py" </code>

<br />

 <code><br />&lt;location&gt;<br />AddHandler python-program .py<br />PythonPath "[r'c:\\Program Files\\viewvc-1.0.7\\bin\\mod_python']+sys.path"<br />PythonHandler apache<br />PythonDebug On<br />AddDefaultCharset UTF-8<br />&lt/location&gt;<br /></code>

<br />NOTE: The above will work if you have chosen the defaults while installing ViewVC.<br /><br />Done! Goto: http://your-machine/viewcvs.<br /><br />However, I got an error when I did this: "ImportError: No module named apache"<br /><br />So, I tried the alternate approach:<br />A) Copy &lt;viewvc-install-dir&gt;/bin/cgi/*.cgi to &lt;apache-install-dir&gt;/cgi-bin/<br />B) Add the following line to the &lt;apache-install-dir&gt;/conf/httpd.conf file:<br />ScriptAlias /viewvc /cgi-bin/viewvc.cgi<br />C) Restart Apache.<br /><br />Done! Go to: http://localhost/cgi-bin/viewvc.cgi<br />It works for me!! I wish I could fix the other method too.<br /><br />Good. Now that it works, I should be happy. But I was not :( When I 'view' a source file, it does not do the syntax highlighting (I use CVS with C++/C projects and I was not getting the syntax highlighting for these languages). So what do I do? Wanted to integrate some open source syntax highlighters. I dug thru' the code of viewvc.py and from there went on to find the place where the markup is done. (search the code base for view_markup function. I use <a href="http://sourcenav.sourceforge.net/download.html">RedHat sourcenavigator</a> to browse and read code). They seemed to be using some PHP code to get the job done. However, I remembered I was very happy with Google's Prettify (any code you browse on code.google.com has probably used Google prettify to syntax highlight the code). So I decided to use it.<br /><br />Also, using the Google Pettify is quite simple:<br />A) Add the following lines to the "head" section:<br />

 <code><br />&lt;link href="[docroot]/prettify/prettify.css" type="text/css" rel="stylesheet" /&gt;<br />&lt;script type="text/javascript" src="[docroot]/prettify/prettify.js" &gt; &lt; /script &gt;<br /></code>

<br />B) Add "onload=prettyPrint()" attribute to the "body" tag.<br />C) Put your code in &lt;pre class="prettyprint"&gt; or &lt;code class="prettyprint" &gt;tags.<br />D) Done!<br /><br />It took quite some reading of the ViewVC python code to figure out simple ways to do it. Here is my story:<br />I read thru the ViewVC python code and found that there was a header and footer being used for each page. Then there was a template for markup and each of the different views that ViweVC supports. Then I stumbled upon the EZT class (EaZyTemplates). Just what I needed to integrate with Google Prettify!! So I found the templates being loaded by ViewVC. They are loacated under &lt;viewvc-install-dir&gt;/templates/. Here are my modifications:<br />1. Download Google Prettify from: http://code.google.com/p/google-code-prettify/<br />2. Unzip it. Copy the src folder to &lt;viewvc-install-dir&gt;/templates/docroot/<br />3. I renamed the src folder to prettify (just to help me later)<br />4. Add the following lines to &lt;viewvc-install-dir&gt;/templates/include/header.ezt, in the "head" section:<br />

 <code><br />&lt;link href="[docroot]/prettify/prettify.css" type="text/css" rel="stylesheet"/&gt;<br />&lt;script type="text/javascript" src="%5Bdocroot%5D/prettify/prettify.js"&gt;&lt;/script&gt;<br /></code>

<br />also, modify the body tag to: &lt;body onload="prettyPrint()"&gt;<br />5. Modify &lt;viewvc-install-dir&gt;/templates/markup.ezt:<br />Change this: &lt;div id="vc_markup"&gt;&lt;pre&t;[markup]&lt;/pre&gt;&lt;/div&gt;<br />to: &lt;div id="vc_markup"&gt;&lt;pre class="prettyprint"&gt;[markup]&lt;/pre&gt;&lt;/div&gt;<br /><br />Done!.<br /><br />Have fun! And post your questions as comments.<div class="blogger-post-footer">My experiments with Computers, Computing, Programming & Software.</div>
